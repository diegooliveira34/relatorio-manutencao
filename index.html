<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Relat√≥rio de Manuten√ß√£o</title>

<style>
body {
    font-family: Arial, sans-serif;
    background:#f1f5f9;
    margin:0; padding:20px;
}
.container {
    max-width:650px;
    margin:auto;
    background:white;
    padding:20px;
    border-radius:15px;
    box-shadow:0 2px 10px rgba(0,0,0,0.15);
}
h2 {
    text-align:center;
    color:#1f2937;
    font-weight:bold;
}
label {
    font-weight:bold;
    margin-top:12px;
    display:block;
}
input, textarea, select {
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
    margin-top:5px;
}
textarea { min-height:70px; }
button {
    width:100%;
    padding:12px;
    border:none;
    border-radius:10px;
    background:#2563eb;
    color:white;
    font-size:16px;
    cursor:pointer;
    margin-top:15px;
}
button.secondary { background:#0ea5e9; }
button.danger { background:#dc2626; margin-top:10px; }
#resultado {
    white-space:pre-wrap;
    background:#f9fafb;
    padding:15px;
    border-radius:10px;
    margin-top:20px;
}
.equipamento {
    background:#f0f4f8;
    border-radius:12px;
    padding:12px;
    margin-top:12px;
}
.hidden { display:none; }
small {
    display:block;
    margin-top:10px;
    text-align:center;
    color:#6b7280;
}
</style>
</head>

<body>
<div class="container">

<h2><b>RELAT√ìRIO DE MANUTEN√á√ÉO</b></h2>

<label>üìÜ Data:</label>
<input type="date" id="data" spellcheck="true" autocorrect="on" autocomplete="on" autocapitalize="sentences">

<label>‚è±Ô∏è Turno:</label>
<select id="turno">
  <option>1¬∫ Turno</option>
  <option>2¬∫ Turno</option>
  <option>3¬∫ Turno</option>
</select>

<label>üë§ T√©cnico Respons√°vel:</label>
<input type="text" id="tecnico" spellcheck="true" autocorrect="on" autocomplete="on" autocapitalize="sentences">

<h3 style="margin-top:18px;">EVENTOS DE MANUTEN√á√ÉO</h3>
<div id="eventos"></div>

<button onclick="adicionarEvento()">+ Adicionar Equipamento</button>

<label style="margin-top:15px;"><b>NECESSITA PLANO PREVENTIVO?</b></label>
<select id="preventivo" onchange="mostrarCamposPlano()">
  <option value="N√£o">N√£o</option>
  <option value="Sim">Sim</option>
</select>

<div id="planoExtras" class="hidden">
    <label><b>EQUIPAMENTO DO PLANO</b>:</label>
    <select id="planoEquipSelect"></select>

    <label><b>DESCRI√á√ÉO DO PLANO</b>:</label>
    <textarea id="planoDesc" spellcheck="true" autocorrect="on" autocomplete="on" autocapitalize="sentences"></textarea>
</div>

<button onclick="gerarRelatorio()">Gerar Relat√≥rio</button>
<button class="secondary" onclick="enviarWhatsApp()">Enviar via Whatsapp</button>
<button class="secondary" onclick="limparCampos()">Limpar</button>

<div id="resultado"></div>

<small>Salve como <b>UTF-8 sem BOM</b>.</small>

</div>

<script>
(function(){
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    document.getElementById("data").value = `${yyyy}-${mm}-${dd}`;
})();

let contador = 0;

function atualizarListaEquipPlano(){
    const select = document.getElementById("planoEquipSelect");
    select.innerHTML = "";

    const equipamentos = document.querySelectorAll(".equip");
    equipamentos.forEach(eq => {
        const nome = eq.value.trim();
        if (nome !== ""){
            const option = document.createElement("option");
            option.textContent = nome;
            select.appendChild(option);
        }
    });
}

function adicionarEvento(){
    contador++;

    const div = document.createElement("div");
    div.className = "equipamento";
    div.id = "evento_" + contador;

    div.innerHTML = `
        <label><b>EQUIPAMENTO</b>:</label>
        <input type="text" class="equip"
        spellcheck="true" autocorrect="on" autocomplete="on" autocapitalize="sentences"
        oninput="atualizarListaEquipPlano()">

        <label><b>PROBLEMA</b>:</label>
        <textarea class="prob"
        spellcheck="true" autocorrect="on" autocomplete="on" autocapitalize="sentences"></textarea>

        <label><b>A√á√ÉO</b>:</label>
        <textarea class="acao"
        spellcheck="true" autocorrect="on" autocomplete="on" autocapitalize="sentences"></textarea>

        <button class="danger" onclick="removerEvento(${contador})">Remover Equipamento</button>
    `;

    document.getElementById("eventos").appendChild(div);
    atualizarListaEquipPlano();
}

function removerEvento(id){
    const box = document.getElementById("evento_" + id);
    if (box) box.remove();
    atualizarListaEquipPlano();
}

function mostrarCamposPlano(){
    const preventivo = document.getElementById("preventivo").value;
    const extras = document.getElementById("planoExtras");

    if (preventivo === "Sim"){
        extras.classList.remove("hidden");
        atualizarListaEquipPlano();
    } else {
        extras.classList.add("hidden");
        document.getElementById("planoDesc").value = "";
    }
}

function formatDateBR(d){
    const p = d.split("-");
    return `${p[2]}/${p[1]}/${p[0]}`;
}

function gerarRelatorio(){
    const data = document.getElementById("data").value;
    const turno = document.getElementById("turno").value;
    const tecnico = document.getElementById("tecnico").value.trim();
    const preventivo = document.getElementById("preventivo").value;
    const planoEquip = document.getElementById("planoEquipSelect").value;
    const planoDesc = document.getElementById("planoDesc").value.trim();
    const eventos = document.querySelectorAll(".equipamento");

    if (!data || !tecnico){
        alert("Preencha Data e T√©cnico.");
        return;
    }

    if (eventos.length === 0){
        alert("Adicione pelo menos um equipamento.");
        return;
    }

    if (preventivo === "Sim"){
        if (!planoEquip || !planoDesc){
            alert("Selecione o equipamento e preencha a descri√ß√£o do plano.");
            return;
        }
    }

    let msg =
`üìÑ RELAT√ìRIO DE MANUTEN√á√ÉO
üìÜ Data: ${formatDateBR(data)}
‚è±Ô∏è Turno: ${turno}
üë§ T√©cnico Respons√°vel: ${tecnico}

`;

    eventos.forEach(ev => {
        const eq = ev.querySelector(".equip").value.trim();
        const pr = ev.querySelector(".prob").value.trim();
        const ac = ev.querySelector(".acao").value.trim();

        msg += `EQUIPAMENTO: ${eq}\n`;
        if (pr) msg += `PROBLEMA: ${pr}\n`;
        if (ac) msg += `A√á√ÉO: ${ac}\n`;
        msg += `\n`;
    });

    msg += `NECESSITA PLANO PREVENTIVO: ${preventivo}`;

    if (preventivo === "Sim"){
        msg += `\nEQUIPAMENTO DO PLANO: ${planoEquip}`;
        msg += `\nDESCRI√á√ÉO DO PLANO: ${planoDesc}`;
    }

    document.getElementById("resultado").textContent = msg;
}

function enviarWhatsApp(){
    const texto = document.getElementById("resultado").textContent;

    if (!texto){
        alert("Gere o relat√≥rio antes de enviar.");
        return;
    }

    window.open("https://wa.me/?text=" + encodeURIComponent(texto), "_blank");
}

function limparCampos(){
    document.getElementById("tecnico").value = "";
    document.getElementById("eventos").innerHTML = "";
    document.getElementById("resultado").textContent = "";
    document.getElementById("planoExtras").classList.add("hidden");
    document.getElementById("planoDesc").value = "";
}
</script>

</body>
</html>




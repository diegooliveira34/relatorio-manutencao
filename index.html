<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Relat√≥rio de Manuten√ß√£o</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f1f5f9; margin:0; padding:18px; color:#222; }
    .container { max-width:720px; margin:auto; background:#fff; padding:18px; border-radius:14px; box-shadow:0 6px 20px rgba(0,0,0,0.08); }
    h2 { text-align:center; color:#2563eb; margin:6px 0 10px; }
    label { font-weight:700; display:block; margin-top:12px; }
    input[type="text"], input[type="date"], select, textarea {
      width:100%; padding:10px; border-radius:8px; border:1px solid #cbd5e1; margin-top:6px; box-sizing:border-box;
    }
    button { padding:10px 12px; border:0; border-radius:10px; background:#2563eb; color:white; cursor:pointer; margin-top:12px; }
    button.secondary { background:#06b6d4; }
    button.danger { background:#ef4444; }
    .row { display:flex; gap:8px; margin-top:8px; }
    .row > * { flex:1; }
    .equipamento { background:#f8fafc; padding:10px; border-radius:10px; margin-top:10px; border:1px solid #e2e8f0; }
    #resultado { white-space:pre-wrap; background:#f9fafb; padding:12px; border-radius:8px; margin-top:14px; font-family:monospace; min-height:60px; }
    small.hint { color:#4b5563; display:block; margin-top:8px; }
    .controls { display:flex; gap:8px; align-items:center; margin-top:8px; }
    .controls label { font-weight:normal; margin:0; }
    input[type="checkbox"] { transform:scale(1.1); margin-right:6px; vertical-align:middle; }
  </style>
</head>
<body>
  <div class="container">
    <h2>üóíÔ∏è Relat√≥rio de Manuten√ß√£o</h2>

    <label>Data:</label>
    <input type="date" id="data">

    <label>Turno:</label>
    <select id="turno">
      <option>1¬∫ Turno</option>
      <option>2¬∫ Turno</option>
      <option>3¬∫ Turno</option>
    </select>

    <label>T√©cnico Respons√°vel:</label>
    <input type="text" id="tecnico" placeholder="Nome do t√©cnico">

    <h3 style="margin-top:14px;">Eventos de Manuten√ß√£o</h3>
    <div id="eventos"></div>

    <div class="row">
      <button onclick="adicionarEvento()">+ Adicionar Equipamento</button>
      <button class="secondary" onclick="limparCampos()">Limpar</button>
    </div>

    <label style="margin-top:12px;">Necessita Plano Preventivo?</label>
    <select id="preventivo">
      <option>N√£o</option>
      <option>Sim</option>
    </select>

    <div class="controls">
      <input type="checkbox" id="usarEmojis" checked>
      <label for="usarEmojis">Enviar com emojis (marque se quer emojis)</label>
      <div style="flex:1"></div>
    </div>

    <div class="row">
      <button onclick="gerarRelatorio()">Gerar Relat√≥rio</button>
      <button class="secondary" onclick="enviarWhatsApp()">Enviar via WhatsApp</button>
    </div>

    <div id="resultado" aria-live="polite"></div>

    <small class="hint">Salve este arquivo como <strong>UTF-8 sem BOM</strong>. Abra no Chrome do celular para adicionar √† tela inicial.</small>
  </div>

<script>
  // Preenche data atual
  (function setDefaultDate(){
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    const iso = `${yyyy}-${mm}-${dd}`;
    document.getElementById('data').value = iso;
  })();

  let contador = 0;

  function adicionarEvento(){
    contador++;
    const div = document.createElement('div');
    div.className = 'equipamento';
    div.id = 'evento_' + contador;

    div.innerHTML = `
      <label>‚öôÔ∏è Equipamento:</label>
      <input type="text" class="equip" placeholder="Ex: Cap 30">

      <label>‚ùó Problema:</label>
      <textarea class="prob" rows="2" placeholder="Descreva o problema"></textarea>

      <label>üõ†Ô∏è A√ß√£o:</label>
      <textarea class="acao" rows="2" placeholder="Descreva a a√ß√£o realizada"></textarea>

      <div style="text-align:right; margin-top:8px;">
        <button class="danger" onclick="removerEvento(${contador})">Remover Equipamento</button>
      </div>
    `;
    document.getElementById('eventos').appendChild(div);
    // rolar para o novo equipamento em dispositivos m√≥veis
    setTimeout(()=>{ div.scrollIntoView({behavior:'smooth', block:'center'}); }, 120);
  }

  function removerEvento(id){
    const el = document.getElementById('evento_' + id);
    if(el) el.remove();
  }

  // Mapa de substitui√ß√£o (caso usu√°rio desmarque emojis)
  const EMOJI_TO_TEXT = {
    'üóíÔ∏è': 'Relat√≥rio de Manuten√ß√£o',
    'üìÖ': 'Data:',
    'üïí': 'Turno:',
    'üë∑': 'T√©cnico Respons√°vel:',
    '‚öôÔ∏è': 'Equipamento:',
    '‚ùó': 'Problema:',
    'üõ†Ô∏è': 'A√ß√£o:',
    // caso apare√ßa varia√ß√µes sem VS16, adicionamos tamb√©m:
    'üóí': 'Relat√≥rio de Manuten√ß√£o',
    '‚öô': 'Equipamento',
    'üõ†': 'A√ß√£o'
  };

  function substituirEmojisPorTexto(str) {
    let out = str;
    // substituir cada ocorr√™ncia de emoji por sua descri√ß√£o
    for (const [emoji, txt] of Object.entries(EMOJI_TO_TEXT)) {
      out = out.split(emoji).join(txt);
    }
    return out;
  }

  function gerarRelatorio(){
    const data = document.getElementById('data').value;
    const turno = document.getElementById('turno').value;
    const tecnico = document.getElementById('tecnico').value.trim();
    const preventivo = document.getElementById('preventivo').value;
    const eventos = document.querySelectorAll('.equipamento');

    if(!data || !tecnico){
      alert('Preencha Data e T√©cnico.');
      return;
    }
    if(eventos.length === 0){
      alert('Adicione pelo menos um equipamento.');
      return;
    }

    // montar mensagem com emojis padr√£o (se marcados)
    let usarEmojis = document.getElementById('usarEmojis').checked;

    let msg = '';
    if (usarEmojis) {
      msg += `üóíÔ∏è Relat√≥rio de Manuten√ß√£o\n`;
      msg += `üìÖ Data: ${formatBR(data)}\n`;
      msg += `üïí Turno: ${turno}\n`;
      msg += `üë∑ T√©cnico Respons√°vel: ${tecnico}\n\n`;
    } else {
      msg += `Relat√≥rio de Manuten√ß√£o\n`;
      msg += `Data: ${formatBR(data)}\n`;
      msg += `Turno: ${turno}\n`;
      msg += `T√©cnico Respons√°vel: ${tecnico}\n\n`;
    }

    eventos.forEach(ev => {
      const eq = ev.querySelector('.equip').value.trim() || '(n√£o informado)';
      const pr = ev.querySelector('.prob').value.trim();
      const ac = ev.querySelector('.acao').value.trim();

      if (usarEmojis) msg += `‚öôÔ∏è Equipamento: ${eq}\n`;
      else msg += `Equipamento: ${eq}\n`;

      if(pr) {
        if (usarEmojis) msg += `‚ùó Problema: ${pr}\n`;
        else msg += `Problema: ${pr}\n`;
      }
      if(ac) {
        if (usarEmojis) msg += `üõ†Ô∏è A√ß√£o: ${ac}\n`;
        else msg += `A√ß√£o: ${ac}\n`;
      }
      msg += `\n`;
    });

    if (usarEmojis) msg += `üõ†Ô∏è Necessita Plano Preventivo? ${preventivo}`;
    else msg += `Necessita Plano Preventivo? ${preventivo}`;

    // Exibir no resultado
    document.getElementById('resultado').textContent = msg;
  }

  function formatBR(iso) {
    const p = iso.split('-');
    if (p.length === 3) return `${p[2]}/${p[1]}/${p[0]}`;
    return iso;
  }

  function enviarWhatsApp(){
    let texto = document.getElementById('resultado').textContent;
    if(!texto){
      alert('Gere o relat√≥rio antes de enviar.');
      return;
    }

    // Se usu√°rio quer emojis, envia direto.
    // Se n√£o quer emojis, j√° montamos sem emojis. Por√©m alguns dispositivos podem ainda transformar.
    // Para garantir, se usu√°rio desmarcou 'usarEmojis' deixamos texto puro (sem emoji).
    if (!document.getElementById('usarEmojis').checked) {
      // j√° est√° sem emojis
    } else {
      // pequena prote√ß√£o: substituir varia√ß√µes conhecidas por vers√µes "puras" antes do encode
      // (mantemos emojis, mas normalizamos variantes)
      texto = texto.replace(/‚öôÔ∏è/g, '‚öôÔ∏è').replace(/üõ†Ô∏è/g, 'üõ†Ô∏è').replace(/üóíÔ∏è/g,'üóíÔ∏è');
    }

    // encodeURIComponent deve cuidar corretamente de UTF-8
    const url = 'https://wa.me/?text=' + encodeURIComponent(texto);
    window.open(url, '_blank');
  }

  function limparCampos(){
    if (!confirm('Deseja limpar tudo?')) return;
    document.getElementById('tecnico').value = '';
    document.getElementById('eventos').innerHTML = '';
    document.getElementById('resultado').textContent = '';
    contador = 0;
  }

  // dica: caso o WhatsApp ainda mostre ÔøΩ, desmarque 'Enviar com emojis' antes de enviar.
</script>
</body>
</html>
